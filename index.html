<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- ... (cabeçalho igual ao original) ... -->
    <style>
        /* ... (estilos iguais ao original) ... */
    </style>
</head>
<body>
    <!-- ... (corpo igual ao original) ... -->

    <script>
        // Banco de dados simplificado para teste
        const comerciosDatabase = {
            "Belo Horizonte": {
                "São Cristóvão": [
                    { nome: "Mercearia do Zé", tipo: "Mercearia", endereco: "R. Topázio, 123" },
                    { nome: "Açougue Carnes Nobres", tipo: "Açougue", endereco: "R. Safira, 222" },
                    // ... (adicionar mais itens)
                ],
                // ... (outros bairros)
            },
            "Betim": {
                "Alterosa": [
                    { nome: "Mercearia Mineirinha", tipo: "Mercearia", endereco: "R. Cristal, 111" },
                    // ... (adicionar mais itens)
                ],
                // ... (outros bairros)
            },
            "Contagem": {
                "Eldorado": [
                    { nome: "Mercadinho do Trabalhador", tipo: "Mercadinho", endereco: "R. do Trabalho, 999" },
                    // ... (adicionar mais itens)
                ],
                // ... (outros bairros)
            }
        };

        // Sistema de histórico
        class HistoricoManager {
            // ... (código igual ao original) ...
        }

        // Inicialização do sistema
        document.addEventListener('DOMContentLoaded', () => {
            const historicoManager = new HistoricoManager();
            const btnGerar = document.getElementById('btn-gerar');
            const statusInfo = document.getElementById('status-info');
            const loading = document.getElementById('loading');
            const resultadosContainer = document.getElementById('resultados-container');
            
            btnGerar.addEventListener('click', () => {
                statusInfo.style.display = 'none';
                loading.style.display = 'block';
                
                setTimeout(() => {
                    try {
                        gerarRotas(historicoManager);
                    } catch (error) {
                        console.error("Erro ao gerar rotas:", error);
                        statusInfo.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Erro: ${error.message}`;
                    } finally {
                        loading.style.display = 'none';
                        resultadosContainer.style.display = 'block';
                    }
                }, 1500);
            });
        });

        function gerarRotas(historicoManager) {
            // ... (código igual ao original até a linha 355) ...
            
            // Exibir resultados
            exibirResultados(cidade, bairrosSelecionados, historicoManager);
        }

        function exibirResultados(cidade, bairrosSelecionados, historicoManager) {
            // ... (código igual ao original até o loop de comércios) ...
            
            comerciosSelecionados.forEach((comercio, comercioIndex) => {
                // CORREÇÃO AQUI (template string com aspas):
                const comercioId = `${comercio.nome}-${comercio.endereco}`;
                
                if (!historicoManager.comercioJaUtilizado(comercioId)) {
                    // ... (restante do código igual) ...
                }
            });
        }
    </script>
</body>
</html>
